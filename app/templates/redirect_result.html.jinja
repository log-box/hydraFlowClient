<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Результат авторизации</title>
<style>
  :root {
    --bg-gradient: linear-gradient(145deg, #f0f4f8, #ffffff);
    --text-color: #2c3e50;
    --container-bg: #fff;
    --border-color: #e0e6ed;
    --shadow: 0 8px 16px rgba(0, 0, 0, 0.05);
    --accent-color: #007bff;
    --accent-hover: #0056b3;
    --success-color: #28a745;
    --fail-color: #dc3545;
    --code-bg: #f0f0f0;
  }

  * {
    box-sizing: border-box;
  }

  html, body {
    margin: 0;
    padding: 0;
    font-family: "Segoe UI", Roboto, sans-serif;
    background: var(--bg-gradient);
    color: var(--text-color);
  }

  .container {
    max-width: 1000px;
    width: 100%;
    margin: 2rem auto;
    background: var(--container-bg);
    padding: 2rem 1.25rem;
    border: 1px solid var(--border-color);
    border-radius: 12px;
    box-shadow: var(--shadow);
  }

  h2, h3 {
    text-align: center;
    margin-top: 0;
  }

  pre {
    background: var(--code-bg);
    padding: 1em;
    border-radius: 6px;
    white-space: pre-wrap;
    word-break: break-word;
    overflow-x: auto;
    font-size: 0.9rem;
    max-width: 100%;
  }

  .token-container {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .token-blocks {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .token-section {
    flex: 1 1 250px;
    min-width: 250px;
  }

  .token-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .status {
    font-size: 1rem;
    font-weight: bold;
  }

  .status.success {
    color: var(--success-color);
  }

  .status.fail {
    color: var(--fail-color);
  }

  button.copy {
    margin-top: 0.5rem;
    padding: 0.5rem 1rem;
    font-size: 0.85rem;
    background: var(--accent-color);
    color: #fff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.2s;
    width: 100%;
  }

  button.copy:hover {
    background: var(--accent-hover);
  }

  form {
    margin-top: 2rem;
  }

  form label {
    display: block;
    margin-top: 1rem;
    font-weight: 500;
  }

  form input[type="text"],
  form select {
    width: 100%;
    padding: 0.6rem;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    margin-top: 0.3rem;
  }

  form button[type="submit"] {
    margin-top: 1.2rem;
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
    background-color: var(--accent-color);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.2s;
    width: 100%;
  }

  form button[type="submit"]:hover {
    background-color: var(--accent-hover);
  }

  @media (max-width: 600px) {
    .token-header {
      flex-direction: column;
      align-items: flex-start;
    }

    .token-blocks {
      flex-direction: column;
    }

    pre {
      font-size: 0.85rem;
    }
  }
</style>



</head>
<body>
  <div class="container">
    <h2>Ответ от Hydra</h2>
    <pre>{{ token_data }}</pre>

    <div class="token-container">
      <div class="token-blocks">
        <div class="token-section">
          <div class="token-header">
            <h3>ID Token Payload</h3>
            <span class="status {{ 'success' if id_token_validation_status == 'ok' else 'fail' }}">
              {{ '✔ Успешно' if id_token_validation_status == 'ok' else '✖ Ошибка валидации' }}
            </span>
          </div>
          <button class="copy" onclick="copyToClipboard('id_token_raw')">Скопировать</button>
          <pre id="id_token_raw">id_token_payload: {{ id_token_payload }}</pre>
        </div>

        <div class="token-section">
          <div class="token-header">
            <h3>Access Token Payload</h3>
            <span class="status {{ 'success' if access_token_validation_status == 'ok' else 'fail' }}">
              {{ '✔ Успешно' if access_token_validation_status == 'ok' else '✖ Ошибка валидации' }}
            </span>
          </div>
          <button class="copy" onclick="copyToClipboard('access_token_raw')">Скопировать</button>
          <pre id="access_token_raw">{{ access_token_payload }}</pre>
        </div>

        <div class="token-section">
          <div class="token-header">
            <h3>Refresh Token</h3>
          </div>
          <button class="copy" onclick="copyToClipboard('refresh_token')">Скопировать</button>
          <pre id="refresh_token">{{ refresh_token }}</pre>
        </div>
      </div>

      <div>
        <h3>Raw Payload (Base64 decode)</h3>
        <pre>{{ decoded_payload }}</pre>
      </div>

      <form action="{{ logout_url }}" method="get">
        <label>
          post_logout_redirect_uri:
          <select name="post_logout_redirect_uri">
            {% for uri in post_logout_redirect_uris %}
              <option value="{{ uri }}" {% if uri == post_logout_redirect_uri %}selected{% endif %}>
                {{ uri }}
              </option>
            {% endfor %}
          </select>
        </label>

        <input type="hidden" name="id_token_hint" value="{{ id_token_hint }}">

        <label>
          state:
          <input type="text" name="state" value="{{ state }}">
        </label>

        <button type="submit">Выйти!</button>
      </form>
    </div>
  </div>

<script>
  function copyToClipboard(id) {
    const el = document.createElement("textarea");
    el.value = document.getElementById(id).innerText;
    document.body.appendChild(el);
    el.select();
    document.execCommand("copy");
    document.body.removeChild(el);
    alert("Скопировано!");
  }
</script>


  <script>
    function rewriteLogoutAction() {
      const form = document.querySelector('form');
      if (!form || !form.action.includes('localhost:4444')) return;

      const correctedPath = form.action.replace('http://localhost:4444/', '');
      const currentHost = window.location.hostname;
      let baseUrl;

      if (currentHost === "192.168.88.5") {
        baseUrl = "http://192.168.88.5:3001/";
      } else if (currentHost === "logbox.myddns.me") {
        baseUrl = "http://logbox.myddns.me:3001/";
      } else {
        baseUrl = "http://localhost:4444/";
      }
      form.action = baseUrl + correctedPath;
    }
    window.onload = rewriteLogoutAction;
  </script>
</body>
</html>
